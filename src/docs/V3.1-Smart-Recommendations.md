# V3.1 Smart Recommendations System

## Overview
Fast Create Drop页面现在配备了智能推荐系统，根据用户选择的业务场景自动推荐最佳的模板和访问策略配置。

## Architecture

### 1. 智能推荐配置模块 (`/lib/intentRecommendations.ts`)

解耦的配置驱动模块，定义每个业务场景的推荐策略：

```typescript
export interface IntentRecommendation {
  intent: IntentTag;
  recommendedPolicyId: string;      // 推荐的访问策略
  recommendedTemplateId: string;    // 推荐的场景模板
  showRecipient: boolean;           // 是否显示接收者选择器
  defaultRecipientSelected: boolean; // 是否默认选择接收者
  description: string;              // 场景描述
}
```

### 2. 推荐策略配置表

| 业务场景 | 推荐模板 | 推荐策略 | 显示Recipient | 默认选择Recipient |
|---------|---------|---------|--------------|------------------|
| **Lead Generation** | Simple Catalog | Lead Capture | ❌ | ❌ |
| **Sales Follow-up** | Catalog + Quote | Private Share | ✅ | ❌ |
| **Customer Nurturing** | Simple Catalog | Private Share | ✅ | ❌ |

## Key Features

### 1. 自动推荐 (Auto-Recommendation)
- ✅ 切换业务场景时自动选择推荐的模板和策略
- ✅ 黑色"Recommended"徽章标记推荐项
- ✅ Toast通知确认推荐已应用

### 2. 条件渲染 (Conditional Rendering)
- ✅ 根据场景动态显示/隐藏Recipient选择器
- ✅ Lead Generation模式下隐藏Recipient
- ✅ Sales/Nurturing模式下显示Recipient但不强制选择

### 3. 智能验证 (Smart Validation)
- ✅ 创建按钮根据场景要求动态启用/禁用
- ✅ Lead Gen: 只需要Material Pool
- ✅ Sales/Nurturing: 需要Material Pool + Recipient

### 4. 视觉反馈 (Visual Feedback)
- ✅ 配置摘要卡片显示当前智能配置
- ✅ 场景描述横幅解释当前模式
- ✅ 推荐徽章在下拉菜单和触发器中一致显示

## User Workflow

### Scenario 1: Lead Generation
1. 用户选择"Lead Generation"标签页
2. 系统自动推荐:
   - Template: **Simple Catalog** (Recommended)
   - Policy: **Lead Capture** (Recommended)
3. Recipient选择器隐藏
4. 用户只需选择Material Pool即可创建

### Scenario 2: Sales Follow-up
1. 用户选择"Sales Follow-up"标签页
2. 系统自动推荐:
   - Template: **Catalog + Quote** (Recommended)
   - Policy: **Private Share** (Recommended)
3. Recipient选择器显示（必填）
4. 用户需要选择联系人才能创建

### Scenario 3: Customer Nurturing
1. 用户选择"Customer Nurturing"标签页
2. 系统自动推荐:
   - Template: **Simple Catalog** (Recommended)
   - Policy: **Private Share** (Recommended)
3. Recipient选择器显示（必填）
4. 用户需要选择联系人才能创建

## Benefits

### 1. 降低认知负担
用户无需理解复杂的模板和策略配置，系统根据业务意图自动推荐最佳组合。

### 2. 提高效率
默认配置即为最佳实践，减少配置时间，加快Drop创建流程。

### 3. 灵活性
用户仍可手动覆盖推荐配置，满足特殊需求。

### 4. 可扩展性
通过配置文件驱动，易于添加新的业务场景和推荐策略。

## Technical Implementation

### Core Functions
```typescript
// 获取推荐配置
getRecommendationForIntent(intent: IntentTag): IntentRecommendation

// 检查是否为推荐策略
isPolicyRecommended(policyId: string, intent: IntentTag): boolean

// 检查是否为推荐模板
isTemplateRecommended(templateId: string, intent: IntentTag): boolean
```

### Smart Auto-Selection Logic
```typescript
useEffect(() => {
  // 1. 自动选择推荐模板
  const recommendedTemplate = filteredTemplates.find(
    t => t.id === currentRecommendation.recommendedTemplateId
  );
  
  // 2. 自动选择推荐策略
  setSelectedPolicyId(currentRecommendation.recommendedPolicyId);
  
  // 3. 根据场景清除/保留Recipient
  if (!currentRecommendation.showRecipient) {
    setSelectedRecipient(null);
  }
  
  // 4. 显示确认通知
  toast.success('Smart recommendations applied');
}, [currentIntent]);
```

## Future Enhancements

1. **ML-Based Recommendations**: 基于用户历史行为学习推荐
2. **A/B Testing**: 测试不同推荐策略的转化率
3. **Custom Recommendations**: 允许用户保存自定义推荐配置
4. **Recommendation Insights**: 解释为什么推荐特定配置

## Testing

### Test Case 1: Lead Generation Flow
1. 打开Fast Create Drop页面
2. 确认默认在Lead Generation模式
3. 验证Simple Catalog和Lead Capture被标记为Recommended
4. 验证Recipient选择器不显示
5. 选择Material Pool后Create按钮启用

### Test Case 2: Scenario Switching
1. 切换到Sales Follow-up
2. 验证Catalog + Quote和Private Share被推荐
3. 验证Recipient选择器显示
4. 验证toast通知出现
5. 不选择Recipient时Create按钮禁用

### Test Case 3: Manual Override
1. 在任意场景下手动选择非推荐配置
2. 验证用户选择被保留
3. 验证Recommended徽章仍正确显示
4. 验证配置摘要更新

## Files Modified

- ✅ `/lib/intentRecommendations.ts` - 新建配置模块
- ✅ `/components/FastCreateDropV31.tsx` - 集成智能推荐
- ✅ `/types/dropSceneTemplate.ts` - 添加IntentTag类型
- ✅ `/data/standardDropSceneTemplates.ts` - 添加tags字段

## Conclusion

V3.1智能推荐系统通过解耦的配置驱动架构，为用户提供了情景化的智能配置体验，在简化操作的同时保持了灵活性。
