# Distribute v3.2 æ›´æ–°æ€»ç»“

## ğŸ¯ æ ¸å¿ƒæ›´æ–°ï¼šå…¨å±€æ•°æ®æŒä¹…åŒ–ç³»ç»Ÿ

### é—®é¢˜èƒŒæ™¯

åœ¨ v3.1 ä¸­ï¼Œæ‰€æœ‰æ•°æ®ä»…å­˜å‚¨åœ¨ React State ä¸­ï¼Œå¯¼è‡´ï¼š
- âŒ é¡µé¢åˆ·æ–°åæ•°æ®ä¸¢å¤±
- âŒ Settings ä¸­åˆ›å»ºçš„ Custom Policies æ— æ³•åœ¨ Fast Create Drop ä¸­ä½¿ç”¨
- âŒ ç¼ºä¹æ•°æ®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶
- âŒ å¤šæ¨¡å—é—´æ•°æ®å…±äº«å›°éš¾

### è§£å†³æ–¹æ¡ˆ

å®ç°äº†åŸºäº `localStorage` çš„å…¨å±€æŒä¹…åŒ–å­˜å‚¨ç³»ç»Ÿã€‚

## ğŸ“¦ æ–°å¢æ–‡ä»¶

### 1. `/lib/storage.ts` - æ ¸å¿ƒå­˜å‚¨æ¨¡å—
**åŠŸèƒ½ï¼š**
- ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£
- è‡ªåŠ¨æŒä¹…åŒ–åˆ° localStorage
- å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

**å…³é”®æ–¹æ³•ï¼š**
```typescript
// Custom Policies ç›¸å…³
saveCustomPolicies(policies: CustomPolicy[]): void
loadCustomPolicies(): CustomPolicy[]
addCustomPolicy(policy: CustomPolicy): void
updateCustomPolicy(id: string, policy: CustomPolicy): void
deleteCustomPolicy(id: string): void

// å…¶ä»–æ•°æ®ç±»å‹ï¼ˆMaterial Pools, Libraries, Attachments ç­‰ï¼‰
// å‡æä¾›ç±»ä¼¼çš„ CRUD æ–¹æ³•
```

### 2. `/components/DevTools.tsx` - å¼€å‘å·¥å…·é¢æ¿
**åŠŸèƒ½ï¼š**
- ğŸ“Š å®æ—¶æŸ¥çœ‹æ•°æ®ç»Ÿè®¡
- ğŸ’¾ å¯¼å‡º/å¯¼å…¥æ•°æ®ï¼ˆJSON æ ¼å¼ï¼‰
- ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®
- ğŸ”„ åˆ·æ–°ç»Ÿè®¡ä¿¡æ¯

**ä½ç½®ï¼š** é¡µé¢å³ä¸‹è§’å›ºå®šæŒ‰é’®

### 3. `/docs/Data-Persistence-Guide.md` - ä½¿ç”¨æŒ‡å—
å®Œæ•´çš„æ•°æ®æŒä¹…åŒ–ç³»ç»Ÿä½¿ç”¨æ–‡æ¡£

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

### `/App.tsx`
**å˜æ›´ï¼š**
1. å¯¼å…¥ `storage` æ¨¡å—
2. æ‰€æœ‰ state åˆå§‹åŒ–æ—¶ä» localStorage åŠ è½½
3. ä½¿ç”¨ `useEffect` ç›‘å¬æ•°æ®å˜æ›´å¹¶è‡ªåŠ¨ä¿å­˜
4. æ·»åŠ  DevTools ç»„ä»¶

**å…³é”®ä»£ç ï¼š**
```typescript
// åˆå§‹åŒ–æ—¶åŠ è½½
const [customPolicies, setCustomPolicies] = useState<CustomPolicy[]>(() => 
  storage.loadCustomPolicies()
);

// å˜æ›´æ—¶ä¿å­˜
useEffect(() => {
  storage.saveCustomPolicies(customPolicies);
}, [customPolicies]);
```

### `/components/FastCreateDrop.tsx`
**å˜æ›´ï¼š**
1. æ¥æ”¶ `customPolicies` prop
2. æ·»åŠ  Custom Policies ä¸‹æ‹‰é€‰æ‹©å™¨
3. æ˜¾ç¤ºé€‰ä¸­ç­–ç•¥çš„è¯¦ç»†é…ç½®
4. åŒºåˆ†æ ‡å‡†ç­–ç•¥å’Œè‡ªå®šä¹‰ç­–ç•¥çš„é€‰æ‹©çŠ¶æ€

**æ–°å¢åŠŸèƒ½ï¼š**
- "Your Custom Policies" ä¸‹æ‹‰åˆ—è¡¨
- è‡ªå®šä¹‰ç­–ç•¥è¯¦ç»†é…ç½®å±•ç¤º
- é¢„è§ˆé¢æ¿ä¸­çš„ç­–ç•¥ä¿¡æ¯ï¼ˆæ”¯æŒè‡ªå®šä¹‰ç­–ç•¥ï¼‰

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### 1. è‡ªåŠ¨æŒä¹…åŒ–
- æ‰€æœ‰æ•°æ®å˜æ›´è‡ªåŠ¨ä¿å­˜åˆ° localStorage
- é¡µé¢åˆ·æ–°åæ•°æ®å®Œæ•´ä¿ç•™
- æ— éœ€æ‰‹åŠ¨ä¿å­˜æ“ä½œ

### 2. è·¨æ¨¡å—æ•°æ®å…±äº«
```
Settings â†’ åˆ›å»º Custom Policy
   â†“ (è‡ªåŠ¨ä¿å­˜)
localStorage
   â†“ (è‡ªåŠ¨åŠ è½½)
Fast Create Drop â†’ ä½¿ç”¨ Custom Policy
```

### 3. æ•°æ®å¤‡ä»½ä¸æ¢å¤
- ä¸€é”®å¯¼å‡ºæ‰€æœ‰æ•°æ®ï¼ˆJSON æ–‡ä»¶ï¼‰
- æ”¯æŒå¯¼å…¥æ•°æ®æ¢å¤
- ä¾¿äºæ•°æ®è¿ç§»å’Œå¤‡ä»½

### 4. å¼€å‘è°ƒè¯•å·¥å…·
- å®æ—¶æ•°æ®ç»Ÿè®¡
- æ¸…ç©ºæµ‹è¯•æ•°æ®
- Console æ—¥å¿—è¾“å‡º

## ğŸ¨ ç”¨æˆ·ä½“éªŒæ”¹è¿›

### Settings â†’ Access Policies
1. åˆ›å»ºè‡ªå®šä¹‰ç­–ç•¥
2. **æ•°æ®è‡ªåŠ¨ä¿å­˜** âœ…
3. å¯åœ¨ä»»ä½•é¡µé¢ä½¿ç”¨

### Fast Create Drop
1. æŸ¥çœ‹ Standard Policiesï¼ˆæ ‡å‡†ç­–ç•¥ï¼‰
2. **é€‰æ‹© Custom Policiesï¼ˆè‡ªå®šä¹‰ç­–ç•¥ï¼‰** âœ…
3. æŸ¥çœ‹è¯¦ç»†é…ç½®
4. åˆ›å»º Drop

### æ•°æ®æŒä¹…æ€§
- åˆ·æ–°é¡µé¢ â†’ æ•°æ®ä¿ç•™ âœ…
- å…³é—­æ ‡ç­¾é¡µ â†’ æ•°æ®ä¿ç•™ âœ…
- é‡å¯æµè§ˆå™¨ â†’ æ•°æ®ä¿ç•™ âœ…

## ğŸ“Š å­˜å‚¨çš„æ•°æ®ç±»å‹

| æ•°æ®ç±»å‹ | é”®å | è¯´æ˜ |
|---------|------|------|
| Material Pools | `distribute_v3_material_pools` | äº§å“æ±  |
| Product Libraries | `distribute_v3_product_libraries` | äº§å“åº“ |
| Global Attachments | `distribute_v3_global_attachments` | å…¨å±€é™„ä»¶ |
| Scene Templates | `distribute_v3_scene_templates` | åœºæ™¯æ¨¡æ¿ |
| Auth Policies | `distribute_v3_auth_policies` | è®¤è¯ç­–ç•¥ |
| **Custom Policies** | `distribute_v3_custom_policies` | **è‡ªå®šä¹‰ç­–ç•¥** |
| Connected CRM | `distribute_v3_connected_crm` | CRM è¿æ¥ |

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯• Custom Policies æŒä¹…åŒ–

1. **åˆ›å»ºè‡ªå®šä¹‰ç­–ç•¥**
   ```
   Settings â†’ Access Policies
   â†’ Hover ä»»ä¸€æ ‡å‡†ç­–ç•¥
   â†’ ç‚¹å‡» "Duplicate & Edit"
   â†’ ä¿®æ”¹é…ç½®å¹¶ä¿å­˜
   â†’ ç¡®è®¤åœ¨ "Your Custom Policies" ä¸­æ˜¾ç¤º
   ```

2. **åœ¨ Fast Create Drop ä¸­ä½¿ç”¨**
   ```
   Fast Create Drop
   â†’ æ»šåŠ¨åˆ° "AUDIENCE & AUTH"
   â†’ çœ‹åˆ° "Your Custom Policies" ä¸‹æ‹‰æ¡†
   â†’ é€‰æ‹©åˆšåˆ›å»ºçš„ç­–ç•¥
   â†’ æŸ¥çœ‹è¯¦ç»†é…ç½®
   ```

3. **éªŒè¯æŒä¹…åŒ–**
   ```
   åˆ·æ–°é¡µé¢ï¼ˆF5ï¼‰
   â†’ é‡æ–°è¿›å…¥ Fast Create Drop
   â†’ ç¡®è®¤è‡ªå®šä¹‰ç­–ç•¥ä»ç„¶å­˜åœ¨ âœ…
   ```

4. **ä½¿ç”¨ Dev Tools éªŒè¯**
   ```
   ç‚¹å‡»å³ä¸‹è§’ "Dev Tools"
   â†’ æŸ¥çœ‹ "Custom Policies" ç»Ÿè®¡æ•°å­—
   â†’ åº”æ˜¾ç¤ºä½ åˆ›å»ºçš„ç­–ç•¥æ•°é‡
   ```

## ğŸ” è°ƒè¯•æŒ‡å—

### Console æ—¥å¿—
```javascript
ğŸ’¾ Custom Policies saved to localStorage: [...]
ğŸ“‚ Custom Policies loaded from localStorage: [...]
```

### æµè§ˆå™¨å¼€å‘è€…å·¥å…·
1. æ‰“å¼€ DevTools (F12)
2. Application/Storage â†’ Local Storage
3. æŸ¥çœ‹ `distribute_v3_custom_policies`

### Dev Tools é¢æ¿
- å³ä¸‹è§’ "Dev Tools" æŒ‰é’®
- æŸ¥çœ‹æ‰€æœ‰æ•°æ®ç»Ÿè®¡
- å¯¼å‡ºæ•°æ®æ£€æŸ¥å†…å®¹

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æµè§ˆå™¨å­˜å‚¨é™åˆ¶**
   - localStorage é€šå¸¸é™åˆ¶ 5-10MB
   - å¤§é‡æ•°æ®å¯èƒ½æ¥è¿‘é™åˆ¶

2. **éšç§/æ— ç—•æ¨¡å¼**
   - æ•°æ®åœ¨å…³é—­çª—å£åä¼šè¢«æ¸…é™¤

3. **è·¨æµè§ˆå™¨**
   - ä¸åŒæµè§ˆå™¨æ•°æ®ç‹¬ç«‹
   - éœ€ä½¿ç”¨å¯¼å‡º/å¯¼å…¥åŠŸèƒ½è¿ç§»

4. **æ¸…é™¤æµè§ˆå™¨æ•°æ®**
   - ä¼šåˆ é™¤æ‰€æœ‰å­˜å‚¨çš„æ•°æ®
   - å»ºè®®å®šæœŸå¤‡ä»½é‡è¦æ•°æ®

## ğŸš€ æœªæ¥è§„åˆ’

- [ ] äº‘ç«¯åŒæ­¥ï¼ˆéœ€è¦åç«¯æ”¯æŒï¼‰
- [ ] æ•°æ®ç‰ˆæœ¬æ§åˆ¶
- [ ] è‡ªåŠ¨å¤‡ä»½åŠŸèƒ½
- [ ] æ•°æ®å‹ç¼©ä¼˜åŒ–
- [ ] å¤šç”¨æˆ·æ”¯æŒ

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [æ•°æ®æŒä¹…åŒ–ä½¿ç”¨æŒ‡å—](/docs/Data-Persistence-Guide.md)
- [ç³»ç»Ÿæ¶æ„è¯´æ˜](/guidelines/Guidelines.md)

---

**ç‰ˆæœ¬ï¼š** v3.2  
**æ›´æ–°æ—¥æœŸï¼š** 2025-10-16  
**æ ¸å¿ƒæ”¹è¿›ï¼š** å…¨å±€æ•°æ®æŒä¹…åŒ– + Custom Policies è·¨æ¨¡å—ä½¿ç”¨
